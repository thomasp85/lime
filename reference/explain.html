<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Explain model predictions — explain • lime</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/lumen/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Explain model predictions — explain"><meta property="og:description" content="Once an explainer has been created using the lime() function it can be used
to explain the result of the model on new observations. The explain()
function takes new observation along with the explainer and returns a
data.frame with prediction explanations, one observation per row. The
returned explanations can then be visualised in a number of ways, e.g. with
plot_features()."><meta property="og:image" content="https://lime.data-imaginist.com/logo.svg"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">lime</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.5.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    News
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li class="dropdown-header">Release notes</li>
    <li>
      <a href="https://www.data-imaginist.com/2018/lime-v0-4-the-kitten-picture-edition/" class="external-link">Version 0.4.0</a>
    </li>
    <li>
      <a href="https://www.data-imaginist.com/2017/announcing-lime/" class="external-link">Version 0.3.0</a>
    </li>
    <li class="divider">
    <li>
      <a href="../news/index.html">Change log</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/thomasp85/lime" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Explain model predictions</h1>
    <small class="dont-index">Source: <a href="https://github.com/thomasp85/lime/blob/HEAD/R/a_dataframe.R" class="external-link"><code>R/a_dataframe.R</code></a>, <a href="https://github.com/thomasp85/lime/blob/HEAD/R/character.R" class="external-link"><code>R/character.R</code></a>, <a href="https://github.com/thomasp85/lime/blob/HEAD/R/explain.R" class="external-link"><code>R/explain.R</code></a>, and 1 more</small>
    <div class="hidden name"><code>explain.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Once an explainer has been created using the <code><a href="lime.html">lime()</a></code> function it can be used
to explain the result of the model on new observations. The <code>explain()</code>
function takes new observation along with the explainer and returns a
data.frame with prediction explanations, one observation per row. The
returned explanations can then be visualised in a number of ways, e.g. with
<code><a href="plot_features.html">plot_features()</a></code>.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># S3 method for data.frame</span></span>
<span><span class="fu">explain</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">explainer</span>,</span>
<span>  labels <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  n_labels <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">n_features</span>,</span>
<span>  n_permutations <span class="op">=</span> <span class="fl">5000</span>,</span>
<span>  feature_select <span class="op">=</span> <span class="st">"auto"</span>,</span>
<span>  dist_fun <span class="op">=</span> <span class="st">"gower"</span>,</span>
<span>  kernel_width <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  gower_pow <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for character</span></span>
<span><span class="fu">explain</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">explainer</span>,</span>
<span>  labels <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  n_labels <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">n_features</span>,</span>
<span>  n_permutations <span class="op">=</span> <span class="fl">5000</span>,</span>
<span>  feature_select <span class="op">=</span> <span class="st">"auto"</span>,</span>
<span>  single_explanation <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">explain</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">explainer</span>,</span>
<span>  <span class="va">labels</span>,</span>
<span>  n_labels <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">n_features</span>,</span>
<span>  n_permutations <span class="op">=</span> <span class="fl">5000</span>,</span>
<span>  feature_select <span class="op">=</span> <span class="st">"auto"</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for imagefile</span></span>
<span><span class="fu">explain</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">explainer</span>,</span>
<span>  labels <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  n_labels <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">n_features</span>,</span>
<span>  n_permutations <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  feature_select <span class="op">=</span> <span class="st">"auto"</span>,</span>
<span>  n_superpixels <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  weight <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  n_iter <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  p_remove <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  batch_size <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  background <span class="op">=</span> <span class="st">"grey"</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>x</dt>
<dd><p>New observations to explain, of the same format as used when
creating the explainer</p></dd>


<dt>explainer</dt>
<dd><p>An <code>explainer</code> object to use for explaining the observations</p></dd>


<dt>labels</dt>
<dd><p>The specific labels (classes) to explain in case the model is
a classifier. For classifiers either this or <code>n_labels</code> must be given.</p></dd>


<dt>n_labels</dt>
<dd><p>The number of labels to explain. If this is given for
classifiers the top <code>n_label</code> classes will be explained.</p></dd>


<dt>n_features</dt>
<dd><p>The number of features to use for each explanation.</p></dd>


<dt>n_permutations</dt>
<dd><p>The number of permutations to use for each explanation.</p></dd>


<dt>feature_select</dt>
<dd><p>The algorithm to use for selecting features. One of:</p><ul><li><p><code>"auto"</code>: If <code>n_features &lt;= 6</code> use <code>"forward_selection"</code> else use <code>"highest_weights"</code>.</p></li>
<li><p><code>"none"</code>: Ignore <code>n_features</code> and use all features.</p></li>
<li><p><code>"forward_selection"</code>: Add one feature at a time until <code>n_features</code> is
reached, based on quality of a ridge regression model.</p></li>
<li><p><code>"highest_weights"</code>: Fit a ridge regression and select the <code>n_features</code> with
the highest absolute weight.</p></li>
<li><p><code>"lasso_path"</code>: Fit a lasso model and choose the <code>n_features</code> whose lars
path converge to zero the latest.</p></li>
<li><p><code>"tree"</code> : Fit a tree to select <code>n_features</code> (which needs to be a power of
2). It requires last version of <code>XGBoost</code>.</p></li>
</ul></dd>


<dt>dist_fun</dt>
<dd><p>The distance function to use for calculating the distance
from the observation to the permutations. If <code>dist_fun = 'gower'</code> (default)
it will use <code><a href="https://rdrr.io/pkg/gower/man/gower_dist.html" class="external-link">gower::gower_dist()</a></code>. Otherwise it will be forwarded to
<code><a href="https://rdrr.io/r/stats/dist.html" class="external-link">stats::dist()</a></code></p></dd>


<dt>kernel_width</dt>
<dd><p>The width of the exponential kernel that will be used to
convert the distance to a similarity in case <code>dist_fun != 'gower'</code>.</p></dd>


<dt>gower_pow</dt>
<dd><p>A modifier for gower distance. The calculated distance will
be raised to the power of this value.</p></dd>


<dt>...</dt>
<dd><p>Parameters passed on to the <code><a href="model_support.html">predict_model()</a></code> method</p></dd>


<dt>single_explanation</dt>
<dd><p>A boolean indicating whether to pool all text in
<code>x</code> into a single explanation.</p></dd>


<dt>n_superpixels</dt>
<dd><p>The number of segments an image should be split into</p></dd>


<dt>weight</dt>
<dd><p>How high should locality be weighted compared to colour. High
values leads to more compact superpixels, while low values follow the image
structure more</p></dd>


<dt>n_iter</dt>
<dd><p>How many iterations should the segmentation run for</p></dd>


<dt>p_remove</dt>
<dd><p>The probability that a superpixel will be removed in each
permutation</p></dd>


<dt>batch_size</dt>
<dd><p>The number of explanations to handle at a time</p></dd>


<dt>background</dt>
<dd><p>The colour to use for blocked out superpixels</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A data.frame encoding the explanations one row per explained
observation. The columns are:</p><ul><li><p><code>model_type</code>: The type of the model used for prediction.</p></li>
<li><p><code>case</code>: The case being explained (the rowname in <code>cases</code>).</p></li>
<li><p><code>model_r2</code>: The quality of the model used for the explanation</p></li>
<li><p><code>model_intercept</code>: The intercept of the model used for the explanation</p></li>
<li><p><code>model_prediction</code>: The prediction of the observation based on the model
used for the explanation.</p></li>
<li><p><code>feature</code>: The feature used for the explanation</p></li>
<li><p><code>feature_value</code>: The value of the feature used</p></li>
<li><p><code>feature_weight</code>: The weight of the feature in the explanation</p></li>
<li><p><code>feature_desc</code>: A human readable description of the feature importance.</p></li>
<li><p><code>data</code>: Original data being explained</p></li>
<li><p><code>prediction</code>: The original prediction from the model</p></li>
</ul><p>Furthermore classification explanations will also contain:</p><ul><li><p><code>label</code>: The label being explained</p></li>
<li><p><code>label_prob</code>: The probability of <code>label</code> as predicted by <code>model</code></p></li>
</ul></div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Explaining a model and an explainer for it</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/" class="external-link">MASS</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">iris_test</span> <span class="op">&lt;-</span> <span class="va">iris</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">iris_train</span> <span class="op">&lt;-</span> <span class="va">iris</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">iris_lab</span> <span class="op">&lt;-</span> <span class="va">iris</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MASS/man/lda.html" class="external-link">lda</a></span><span class="op">(</span><span class="va">iris_train</span>, <span class="va">iris_lab</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">explanation</span> <span class="op">&lt;-</span> <span class="fu"><a href="lime.html">lime</a></span><span class="op">(</span><span class="va">iris_train</span>, <span class="va">model</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># This can now be used together with the explain method</span></span></span>
<span class="r-in"><span><span class="fu">explain</span><span class="op">(</span><span class="va">iris_test</span>, <span class="va">explanation</span>, n_labels <span class="op">=</span> <span class="fl">1</span>, n_features <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 2 × 13</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   model_type case  label label…¹ model…² model…³ model…⁴ feature featu…⁵ featu…⁶</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> classific… 1     seto…       1   0.543  0.095<span style="text-decoration: underline;">4</span>    1.01 Petal.…     1.4   0.735</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span> classific… 1     seto…       1   0.543  0.095<span style="text-decoration: underline;">4</span>    1.01 Petal.…     0.2   0.179</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># … with 3 more variables: feature_desc &lt;chr&gt;, data &lt;list&gt;, prediction &lt;list&gt;,</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;">#   and abbreviated variable names ¹​label_prob, ²​model_r2, ³​model_intercept,</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;">#   ⁴​model_prediction, ⁵​feature_value, ⁶​feature_weight</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ Use `colnames()` to see all variable names</span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Emil Hvitfeldt, <a href="https://data-imaginist.com" class="external-link">Thomas Lin Pedersen</a>, Michaël Benesty.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer></div>

  


  

  </body></html>

